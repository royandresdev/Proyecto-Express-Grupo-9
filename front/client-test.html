<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Socket.IO Cliente Test</title>
</head>
<body>
  <h1>Cliente Socket.IO Test</h1>
  <button id="connectBtn">Conectar</button>
  <div id="chat" style="display:none; margin-top: 20px;">
    <input id="msgInput" type="text" placeholder="EscribÃ­ tu mensaje aquÃ­" style="width: 300px;" />
    <button id="sendBtn">Enviar mensaje</button>
  </div>
  <pre id="log" style="height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px;"></pre>

  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>

  <script>
    const log = document.getElementById("log");
    const connectBtn = document.getElementById("connectBtn");
    const chatDiv = document.getElementById("chat");
    const msgInput = document.getElementById("msgInput");
    const sendBtn = document.getElementById("sendBtn");

    let socket;
    let userId;

    function logMessage(msg) {
      log.textContent += msg + "\n";
      log.scrollTop = log.scrollHeight;
    }

    connectBtn.onclick = () => {
      socket = io("http://localhost:3000/");

      socket.on("connect", () => {
  userId = socket.id;
  logMessage(`Conectado al servidor con id: ${userId}`);
  connectBtn.disabled = true;
  chatDiv.style.display = "block";

  socket.emit("register", { user_id: userId, nombre: "Tester" });
});
      socket.on("chatMessage", (data) => {
        logMessage(`Mensaje recibido de ${data.from}: ${data.message}`);
      });

      socket.on("dashboardUpdate", (data) => {
        logMessage("Dashboard actualizado: " + JSON.stringify(data));
      });

      // Nuevo: escucha cuando un usuario se conecta
      socket.on("userConnected", (data) => {
        logMessage(data.mensaje || `ğŸŸ¢ Usuario "${data.nombre}" se ha unido al chat.`);
      });

      // Nuevo: escucha cuando un usuario se desconecta
      socket.on("userDisconnected", (data) => {
        logMessage(data.mensaje || `ğŸ”´ Usuario "${data.nombre}" se ha desconectado del chat.`);
      });

      socket.on("disconnect", () => {
        logMessage("Desconectado del servidor");
        connectBtn.disabled = false;
        chatDiv.style.display = "none";
      });
    };

    sendBtn.onclick = () => {
      const message = msgInput.value.trim();
      if (message === "") return;

      socket.emit("chatMessage", { user_id: userId, nombre: "Tester", message });
      logMessage("Mensaje enviado: " + message);
      msgInput.value = "";
      msgInput.focus();
    };

    // Enviar mensaje con Enter en el input
    msgInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        sendBtn.click();
      }
    });
  </script>
</body>
</html>

